{"version":3,"sources":["../src/index.js"],"names":["dotenv","config","myApiKey","app","use","bodyParser","json","express","static","server","http","createServer","io","get","req","res","sendFile","root","post","name","body","username","pass","password","process","env","LOGIN","PASSWORD","cookie_name","make_cookie","fs","writeFileSync","setTimeout","clear_place","cookie","maxAge","status","send","readFileSync","cookies","connections","once","socket","push","console","log","on","splice","indexOf","src","srccc","key","keyyy","options","connection","cluster","reconnect","identity","channels","client","twitch","fsWait","flag","watch","event","filename","main","getLiveChatId","liveChatId","requestChatMessages","chatMessageUrl","nextPageToken","requestProperties","part","maxResults","pageToken","url","qs","error","response","JSON","parse","items","item","authorDetails","displayName","sockets","emit","msg","snippet","displayMessage","pollingIntervalMillis","videoId","callback","bodyObj","liveStreamingDetails","activeLiveChatId","disconnect","connect","channel","user","message","self","signal","sign","winer","win","length","result","characters","charactersLength","i","charAt","Math","floor","random","require","listen"],"mappings":"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","sourcesContent":["/* eslint-disable no-unused-vars */\r\nimport express from 'express';\r\nimport dotenv from 'dotenv';\r\nimport bodyParser from 'body-parser';\r\nimport cookieParser from 'cookie-parser';\r\nimport fs from 'fs';\r\nimport io_r from 'socket.io';\r\nimport http from 'http';\r\nimport request from 'request';\r\nimport twitch from 'twitch-js';\r\n\r\ndotenv.config();\r\n\r\nconst myApiKey = 'AIzaSyARsNN4cTNsHicQ8JpZGTAuJP877w4YY7g';\r\n\r\nconst app = express();\r\napp.use(cookieParser());\r\napp.use(bodyParser.json());\r\napp.use(express.static('web/'));\r\n\r\nconst server = http.createServer(app);\r\nconst io = io_r(server);\r\napp.get('/', function(req, res) {\r\n    res.sendFile('index.htm', { root: 'web/' });\r\n});\r\n\r\napp.post('/login', function(req, res) {\r\n    let name = req.body.username;\r\n    let pass = req.body.password;\r\n    if (name == process.env.LOGIN && pass == process.env.PASSWORD) {\r\n        let cookie_name = make_cookie(15);\r\n        fs.writeFileSync('place.txt', cookie_name);\r\n        setTimeout(clear_place, 3600000);\r\n        res.cookie('Rchiem', cookie_name, {\r\n            maxAge: 3600000,\r\n        });\r\n        res.status(200).send('true');\r\n    } else {\r\n        res.status(404).send('false');\r\n    }\r\n});\r\napp.get('/user', function(req, res) {\r\n    let cookie = fs.readFileSync('place.txt', 'utf8');\r\n    if (req.cookies['Rchiem'] == cookie) {\r\n        res.sendFile('roll.htm', { root: 'web/html' });\r\n        let connections = [];\r\n        io.once('connection', function(socket) {\r\n            connections.push(socket);\r\n            console.log('connected');\r\n            socket.on('disconnect', function(socket) {\r\n                connections.splice(connections.indexOf(socket), 1);\r\n                console.log('disconnected');\r\n            });\r\n        });\r\n    } else {\r\n        res.status(404).send('Перезайдите пожалуйста');\r\n    }\r\n});\r\n\r\napp.post('/src', function(req, res) {\r\n    let src = req.body.srccc;\r\n    fs.writeFileSync('src.txt', src);\r\n    res.status(200);\r\n});\r\n\r\napp.post('/key', function(req, res) {\r\n    let key = req.body.keyyy;\r\n    fs.writeFileSync('key.txt', key);\r\n    res.status(200);\r\n});\r\n\r\nconst options = {\r\n    connection: {\r\n        cluster: 'aws',\r\n        reconnect: true,\r\n    },\r\n    identity: {\r\n        username: 'bot_rchiem',\r\n        password: 'oauth:3ydg9ojjthbb135lgpurekwdr8wu9f',\r\n    },\r\n    channels: ['dota2mc_ru'],\r\n};\r\nconst client = new twitch.client(options);\r\nlet fsWait = false;\r\nlet flag = 0;\r\nfs.watch('signal.txt', function(event, filename) {\r\n    if (filename) {\r\n        if (fsWait) return;\r\n        fsWait = setTimeout(() => {\r\n            fsWait = false;\r\n        }, 100);\r\n        const main = function() {\r\n            let src = fs.readFileSync('src.txt', 'utf8');\r\n            getLiveChatId(src, function(liveChatId) {\r\n                console.log('liveChatId = ' + liveChatId);\r\n                if (liveChatId) {\r\n                    requestChatMessages('', liveChatId);\r\n                }\r\n            });\r\n        };\r\n        const chatMessageUrl =\r\n            'https://www.googleapis.com/youtube/v3/liveChat/messages';\r\n\r\n        const requestChatMessages = function(nextPageToken, liveChatId) {\r\n            const requestProperties = {\r\n                liveChatId: liveChatId,\r\n                part: 'snippet, id, authorDetails',\r\n                key: myApiKey,\r\n                maxResults: 200,\r\n                pageToken: nextPageToken,\r\n            };\r\n            request({ url: chatMessageUrl, qs: requestProperties }, function(\r\n                error,\r\n                response,\r\n                body\r\n            ) {\r\n                body = JSON.parse(body);\r\n                if (body.items) {\r\n                    if (flag != 0) {\r\n                        for (body.items.item of body.items) {\r\n                            if (fs.readFileSync('listen.txt', 'utf8') != 0) {\r\n                                if (\r\n                                    fs.readFileSync('listen.txt', 'utf8') ==\r\n                                    body.items.item.authorDetails.displayName\r\n                                ) {\r\n                                    io.sockets.emit('send mess', {\r\n                                        msg: body.items.item.snippet.displayMessage,\r\n                                        name: body.items.item.authorDetails.displayName,\r\n                                    });\r\n                                }\r\n                            } else {\r\n                                io.sockets.emit('send mess', {\r\n                                    msg: body.items.item.snippet.displayMessage,\r\n                                    name: body.items.item.authorDetails.displayName,\r\n                                });\r\n                                if (\r\n                                    body.items.item.snippet.displayMessage ==\r\n                                    fs.readFileSync('key.txt', 'utf8')\r\n                                ) {\r\n                                    io.sockets.emit('add user', {\r\n                                        name: body.items.item.authorDetails.displayName,\r\n                                    });\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                flag = 1;\r\n                setTimeout(function() {\r\n                    if (fs.readFileSync('signal.txt', 'utf8') == 0) {\r\n                        console.log('stop');\r\n                        flag = 0;\r\n                        return;\r\n                    }\r\n                    requestChatMessages(body.nextPageToken, liveChatId);\r\n                }, body.pollingIntervalMillis);\r\n            });\r\n        };\r\n        const getLiveChatId = function(videoId, callback) {\r\n            const url =\r\n                'https://www.googleapis.com/youtube/v3/videos?id=' +\r\n                videoId +\r\n                '&key=' +\r\n                myApiKey +\r\n                '&part=liveStreamingDetails,snippet';\r\n\r\n            request(url, function(error, response, body) {\r\n                const bodyObj = JSON.parse(body);\r\n                callback(bodyObj.items[0].liveStreamingDetails.activeLiveChatId);\r\n            });\r\n        };\r\n        if (fs.readFileSync('signal.txt', 'utf8') == 1) {\r\n            main();\r\n        }\r\n        if (fs.readFileSync('signal.txt', 'utf8') == 0) {\r\n            client.disconnect();\r\n        }\r\n        if (fs.readFileSync('signal.txt', 'utf8') == 1) {\r\n            client.connect();\r\n        }\r\n    }\r\n});\r\nclient.on('chat', function(channel, user, message, self) {\r\n    if (fs.readFileSync('listen.txt', 'utf8') != 0) {\r\n        if (user['display-name'] == fs.readFileSync('listen.txt', 'utf8')) {\r\n            io.sockets.emit('send mess', {\r\n                msg: message,\r\n                name: user['display-name'],\r\n            });\r\n        }\r\n    } else {\r\n        io.sockets.emit('send mess', {\r\n            msg: message,\r\n            name: user['display-name'],\r\n        });\r\n        if (message == fs.readFileSync('key.txt', 'utf8')) {\r\n            io.sockets.emit('add user', {\r\n                name: user['display-name'],\r\n            });\r\n        }\r\n    }\r\n});\r\n\r\napp.post('/start', function(req, res) {\r\n    let signal = req.body.sign;\r\n    fs.writeFileSync('signal.txt', signal);\r\n    fs.writeFileSync('listen.txt', 0);\r\n    res.status(200);\r\n});\r\napp.post('/choose', function(req, res) {\r\n    let winer = req.body.win;\r\n    fs.writeFileSync('listen.txt', winer);\r\n    res.status(200);\r\n});\r\n\r\napp.post('/stop', function(req, res) {\r\n    let signal = req.body.sign;\r\n    fs.writeFileSync('signal.txt', signal);\r\n    fs.writeFileSync('listen.txt', 0);\r\n    res.status(200);\r\n});\r\n\r\nfunction make_cookie(length) {\r\n    let result = '';\r\n    let characters =\r\n        'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n    let charactersLength = characters.length;\r\n    let i;\r\n    for (i = 0; i < length; i++) {\r\n        result += characters.charAt(\r\n            Math.floor(Math.random() * charactersLength)\r\n        );\r\n    }\r\n    return result;\r\n}\r\n\r\nfunction clear_place() {\r\n    let fs = require('fs');\r\n    fs.writeFileSync('place.txt', '');\r\n}\r\n\r\nserver.listen(3000);\r\nconsole.log('Сервер стартовал!');"],"file":"index.js"}