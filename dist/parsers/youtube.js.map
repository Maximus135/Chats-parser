{"version":3,"sources":["../../src/parsers/youtube.js"],"names":["request","require","express","myApiKey","app","listen","main","src","getLiveChatId","liveChatId","console","log","requestChatMessages","chatMessageUrl","nextPageToken","requestProperties","part","key","maxResults","pageToken","url","qs","error","response","body","JSON","parse","items","participants","item","appendFileSync","authorDetails","displayName","snippet","displayMessage","setTimeout","pollingIntervalMillis","videoId","callback","bodyObj","liveStreamingDetails","activeLiveChatId"],"mappings":";;AAEA;;AAFA;;AACA;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AACA,MAAMC,OAAO,GAAGD,OAAO,CAAC,SAAD,CAAvB;;AACA,MAAME,QAAQ,GAAG,yCAAjB;AACA,MAAMC,GAAG,GAAGF,OAAO,EAAnB;AAEAE,GAAG,CAACC,MAAJ,CAAW,IAAX,EAAiB,YAAW;AACxBC,EAAAA,IAAI;AACP,CAFD;;AAGA,MAAMA,IAAI,GAAG,YAAW;AACpB,MAAIC,GAAG,GAAG,sBAAa,SAAb,EAAwB,MAAxB,CAAV;AACAC,EAAAA,aAAa,CAACD,GAAD,EAAM,UAASE,UAAT,EAAqB;AACpCC,IAAAA,OAAO,CAACC,GAAR,CAAY,kBAAkBF,UAA9B;;AAEA,QAAIA,UAAJ,EAAgB;AACZG,MAAAA,mBAAmB,CAAC,EAAD,EAAKH,UAAL,CAAnB;AACH;AACJ,GANY,CAAb;AAOH,CATD;;AAWA,MAAMI,cAAc,GAChB,yDADJ;;AAGA,MAAMD,mBAAmB,GAAG,UAASE,aAAT,EAAwBL,UAAxB,EAAoC;AAC5D,QAAMM,iBAAiB,GAAG;AACtBN,IAAAA,UAAU,EAAEA,UADU;AAEtBO,IAAAA,IAAI,EAAE,4BAFgB;AAGtBC,IAAAA,GAAG,EAAEd,QAHiB;AAItBe,IAAAA,UAAU,EAAE,GAJU;AAKtBC,IAAAA,SAAS,EAAEL;AALW,GAA1B;AAOAd,EAAAA,OAAO,CAAC;AAAEoB,IAAAA,GAAG,EAAEP,cAAP;AAAuBQ,IAAAA,EAAE,EAAEN;AAA3B,GAAD,EAAiD,UACpDO,KADoD,EAEpDC,QAFoD,EAGpDC,IAHoD,EAItD;AACE,QAAIP,GAAG,GAAG,sBAAa,SAAb,EAAwB,MAAxB,CAAV;AACAO,IAAAA,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWF,IAAX,CAAP;;AACA,QAAIA,IAAI,CAACG,KAAT,EAAgB;AACZ,UAAIC,YAAY,GAAG3B,OAAO,CAAC,IAAD,CAA1B;;AACA,WAAKuB,IAAI,CAACG,KAAL,CAAWE,IAAhB,IAAwBL,IAAI,CAACG,KAA7B,EAAoC;AAChC;AACAC,QAAAA,YAAY,CAACE,cAAb,CACI,oBADJ,EAEIN,IAAI,CAACG,KAAL,CAAWE,IAAX,CAAgBE,aAAhB,CAA8BC,WAA9B,GACA,KADA,GAEAR,IAAI,CAACG,KAAL,CAAWE,IAAX,CAAgBI,OAAhB,CAAwBC,cAFxB,GAGA,IALJ,EAFgC,CAShC;AACA;AACA;AACA;AACH;AACJ;;AACDC,IAAAA,UAAU,CAAC,YAAW;AAClBvB,MAAAA,mBAAmB,CAACY,IAAI,CAACV,aAAN,EAAqBL,UAArB,CAAnB;AACH,KAFS,EAEPe,IAAI,CAACY,qBAFE,CAAV;AAGH,GA3BM,CAAP;AA4BH,CApCD;;AAsCA,MAAM5B,aAAa,GAAG,UAAS6B,OAAT,EAAkBC,QAAlB,EAA4B;AAC9C,QAAMlB,GAAG,GACL,qDACAiB,OADA,GAEA,OAFA,GAGAlC,QAHA,GAIA,oCALJ;AAOAH,EAAAA,OAAO,CAACoB,GAAD,EAAM,UAASE,KAAT,EAAgBC,QAAhB,EAA0BC,IAA1B,EAAgC;AACzC,UAAMe,OAAO,GAAGd,IAAI,CAACC,KAAL,CAAWF,IAAX,CAAhB;AAEAc,IAAAA,QAAQ,CAACC,OAAO,CAACZ,KAAR,CAAc,CAAd,EAAiBa,oBAAjB,CAAsCC,gBAAvC,CAAR;AACH,GAJM,CAAP;AAKH,CAbD","sourcesContent":["/* eslint-disable no-unused-vars */\r\n/* eslint-disable no-undef */\r\nimport { read, readFileSync } from 'fs';\r\nconst request = require('request');\r\nconst express = require('express');\r\nconst myApiKey = 'AIzaSyARsNN4cTNsHicQ8JpZGTAuJP877w4YY7g';\r\nconst app = express();\r\n\r\napp.listen(4000, function() {\r\n    main();\r\n});\r\nconst main = function() {\r\n    let src = readFileSync('src.txt', 'utf8');\r\n    getLiveChatId(src, function(liveChatId) {\r\n        console.log('liveChatId = ' + liveChatId);\r\n\r\n        if (liveChatId) {\r\n            requestChatMessages('', liveChatId);\r\n        }\r\n    });\r\n};\r\n\r\nconst chatMessageUrl =\r\n    'https://www.googleapis.com/youtube/v3/liveChat/messages';\r\n\r\nconst requestChatMessages = function(nextPageToken, liveChatId) {\r\n    const requestProperties = {\r\n        liveChatId: liveChatId,\r\n        part: 'snippet, id, authorDetails',\r\n        key: myApiKey,\r\n        maxResults: 200,\r\n        pageToken: nextPageToken,\r\n    };\r\n    request({ url: chatMessageUrl, qs: requestProperties }, function(\r\n        error,\r\n        response,\r\n        body\r\n    ) {\r\n        let key = readFileSync('key.txt', 'utf8');\r\n        body = JSON.parse(body);\r\n        if (body.items) {\r\n            let participants = require('fs');\r\n            for (body.items.item of body.items) {\r\n                //if (body.items.item.snippet.displayMessage === key) {\r\n                participants.appendFileSync(\r\n                    './participants.txt',\r\n                    body.items.item.authorDetails.displayName +\r\n                    ' : ' +\r\n                    body.items.item.snippet.displayMessage +\r\n                    '\\n'\r\n                );\r\n                // console.log(\r\n                //     item.authorDetails.displayName + ':' + item.snippet.displayMessage\r\n                // );\r\n                // }\r\n            }\r\n        }\r\n        setTimeout(function() {\r\n            requestChatMessages(body.nextPageToken, liveChatId);\r\n        }, body.pollingIntervalMillis);\r\n    });\r\n};\r\n\r\nconst getLiveChatId = function(videoId, callback) {\r\n    const url =\r\n        'https://www.googleapis.com/youtube/v3/videos?id=' +\r\n        videoId +\r\n        '&key=' +\r\n        myApiKey +\r\n        '&part=liveStreamingDetails,snippet';\r\n\r\n    request(url, function(error, response, body) {\r\n        const bodyObj = JSON.parse(body);\r\n\r\n        callback(bodyObj.items[0].liveStreamingDetails.activeLiveChatId);\r\n    });\r\n};"],"file":"youtube.js"}